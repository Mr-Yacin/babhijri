---
import { ANALYTICS_CONFIG } from '../../config';
import { isAnalyticsEnabledPage } from '../../lib/utils/analytics';

const { measurementId, enabled } = ANALYTICS_CONFIG.ga4;
const currentPath = Astro.url.pathname;
const shouldLoadAnalytics = enabled && measurementId && isAnalyticsEnabledPage(currentPath);
---

{shouldLoadAnalytics && (
    <>
        <!-- Google tag (gtag.js) -->
        <script is:inline async src={`https://www.googletagmanager.com/gtag/js?id=${measurementId}`}></script>
        <script is:inline define:vars={{ measurementId }}>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', measurementId, {
                page_path: window.location.pathname,
            });
        </script>
    </>
)}
