---
import Layout from '../../layouts/Layout.astro';
import Footer from '../../components/common/Footer.astro';
import { SITE_CONFIG } from '../../config';
import LoginForm from '../../components/auth/LoginForm.svelte';
---

<Layout title={`تسجيل الدخول | ${SITE_CONFIG.name}`}>
	<main class="min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8">
		<!-- Loading state while checking auth -->
		<div id="auth-check-loader" class="max-w-md w-full text-center">
			<div class="w-12 h-12 border-4 border-teal-200 border-t-teal-600 rounded-full animate-spin mx-auto mb-4"></div>
			<p class="text-gray-600">جاري التحقق...</p>
		</div>

		<!-- Login form (hidden initially) -->
		<div id="login-form-container" class="max-w-md w-full space-y-8 bg-white p-8 rounded-2xl shadow-sm border border-gray-100 hidden">
			<div class="text-center">
				<h2 class="mt-6 text-3xl font-extrabold text-gray-900">
					مرحباً بك في {SITE_CONFIG.name}
				</h2>
				<p class="mt-2 text-sm text-gray-600">
					سجل دخولك للمتابعة
				</p>
			</div>
			
			<LoginForm client:load />
		</div>
	</main>

	<script>
		import { authStore } from "../../lib/stores/auth";

		const loader = document.getElementById("auth-check-loader");
		const formContainer = document.getElementById("login-form-container");

		// Redirect to dashboard if already logged in
		const unsubscribe = authStore.subscribe((state) => {
			if (!state.loading) {
				if (state.isLoggedIn) {
					// User is logged in, redirect to dashboard
					window.location.href = "/app/dashboard";
				} else {
					// User is not logged in, show the form
					if (loader) loader.style.display = "none";
					if (formContainer) formContainer.classList.remove("hidden");
				}
			}
		});
	</script>

	<Footer />
</Layout>
